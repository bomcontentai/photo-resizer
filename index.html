<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Premium Bulk Resizer - Pastel Theme</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lzma@2.3.2/src/lzma-worker.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        
        body { 
            font-family: 'Kanit', sans-serif; 
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1f9 100%); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 40px; 
            min-height: 100vh;
            color: #4a4a4a;
        }

        .container { 
            background: rgba(255, 255, 255, 0.9); 
            padding: 40px; 
            border-radius: 30px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.05); 
            width: 100%; 
            max-width: 750px; 
            text-align: center; 
            backdrop-filter: blur(10px);
        }

        h1 { color: #ff6f91; font-weight: 600; margin-bottom: 10px; font-size: 28px; }
        p { color: #8e8e8e; margin-bottom: 30px; font-weight: 300; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà */
        .upload-box { 
            border: 2px dashed #ffb6c1; 
            padding: 40px; 
            border-radius: 20px; 
            cursor: pointer; 
            background: #fffafa; 
            margin-bottom: 30px; 
            transition: all 0.3s ease;
            color: #ff6f91;
        }
        .upload-box:hover { 
            background: #ffe4e1; 
            border-color: #ff6f91; 
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 111, 145, 0.1);
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
        .controls { 
            background: #ffffff; 
            padding: 25px; 
            border-radius: 20px; 
            margin-bottom: 30px; 
            display: none; 
            text-align: left; 
            border: 1px solid #f0f0f0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.02);
        }
        .select-all-wrapper { 
            margin-bottom: 20px; 
            padding-bottom: 15px; 
            border-bottom: 1px solid #f8f8f8; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            font-weight: 600; 
            color: #ff6f91; 
        }
        .download-options { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; color: #555; }
        
        select { 
            padding: 10px 15px; 
            border-radius: 12px; 
            border: 2px solid #ffe4e1; 
            font-family: 'Kanit'; 
            outline: none; 
            background: white;
            color: #ff6f91;
            cursor: pointer;
        }

        /* ‡πÅ‡∏ñ‡∏ö‡∏™‡πÑ‡∏•‡∏î‡πå‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° */
        .slider-container {
            position: relative; width: 100%; height: 110px; 
            background: linear-gradient(90deg, #ffe4e1, #e2d1f9); 
            border-radius: 55px;
            display: none; align-items: center; margin: 30px 0; overflow: hidden;
            box-shadow: inset 0 3px 10px rgba(0,0,0,0.05); user-select: none;
        }
        .slider-text { width: 100%; text-align: center; color: #a278b5; font-weight: 600; font-size: 18px; z-index: 1; pointer-events: none; }
        .cart-handle {
            position: absolute; left: 5px; width: 100px; height: 100px;
            background-image: url('https://drive.google.com/thumbnail?id=1OQR1lDbavCtrcbyCiN0WKK3PPHbd6Y95&sz=w200');
            background-size: contain; background-repeat: no-repeat; background-position: center;
            background-color: white; border-radius: 50%; cursor: grab; z-index: 2; 
            box-shadow: 0 8px 20px rgba(162, 120, 181, 0.3);
        }

        /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß */
        .preview-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; margin-top: 30px; }
        .preview-item { 
            position: relative; 
            border: 1px solid #f0f0f0; 
            padding: 15px; 
            border-radius: 20px; 
            background: white; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .preview-item:hover { 
            border-color: #ffb6c1; 
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.05); 
        }
        canvas { width: 100%; border-radius: 12px; display: block; }
        .check-box-wrapper { margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; color: #888; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå Custom Checkbox */
        .check-box { 
            accent-color: #ff6f91;
            transform: scale(1.4); 
            cursor: pointer; 
        }
        
        #loading { display: none; color: #a278b5; font-weight: 600; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üéÄ ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏†‡∏≤‡∏û O2O ‡πÄ‡∏£‡∏¥‡∏®‡πÄ‡∏ß‡πà‡∏≠‡∏£‡πå</h1>
    <p>1000x1000px ‚Ä¢ ‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‚Ä¢ ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö‡∏£‡∏π‡∏õ 1 ‡∏ô‡∏¥‡πâ‡∏ß ‡πÅ‡∏ö‡∏ö‡∏â‡∏ö‡∏±‡∏ö‡∏Ñ‡∏ô‡∏Ç‡∏µ‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏à</p>

    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <strong>‚ú® ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚ú®</strong>
        <input type="file" id="fileInput" accept="image/jpeg, image/jpg" multiple style="display:none">
    </div>

    <div id="controls" class="controls">
        <div class="select-all-wrapper">
            <input type="checkbox" id="selectAll" class="check-box" checked>
            <label for="selectAll">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
        </div>
        
        <div class="download-options">
            <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å: </label>
            <select id="downloadFormat">
                <option value="individual">‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå (.jpg)</option>
                <option value="zip">‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏ß‡∏° (.zip)</option>
                <option value="7z">‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏ß‡∏° (.7z)</option>
            </select>
        </div>
    </div>

    <div id="loading">‚ú® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡πà‡∏≤‡∏¢‡∏°‡∏ô‡∏ï‡∏£‡πå‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì...‡∏£‡∏≠‡πÅ‡∏õ‡πâ‡∏ö</div>

    <div id="sliderWrapper" class="slider-container">
        <span class="slider-text">‡πÄ‡∏Ç‡πá‡∏ô‡∏£‡∏ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å >>></span>
        <div id="cartBtn" class="cart-handle"></div>
    </div>

    <div id="previewContainer" class="preview-container"></div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    const sliderWrapper = document.getElementById('sliderWrapper');
    const controls = document.getElementById('controls');
    const cartBtn = document.getElementById('cartBtn');
    const loading = document.getElementById('loading');
    const selectAll = document.getElementById('selectAll');
    const downloadFormat = document.getElementById('downloadFormat');
    let processedItems = [];

    fileInput.addEventListener('change', async function(e) {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;

        previewContainer.innerHTML = '';
        processedItems = [];
        sliderWrapper.style.display = 'none';
        controls.style.display = 'none';
        loading.style.display = 'block';

        for (const file of files) {
            await processImage(file);
        }

        loading.style.display = 'none';
        if (processedItems.length > 0) {
            sliderWrapper.style.display = 'flex';
            controls.style.display = 'block';
            selectAll.checked = true;
            resetSlider();
        }
    });

    selectAll.addEventListener('change', function() {
        const isChecked = this.checked;
        processedItems.forEach(item => {
            item.checkbox.checked = isChecked;
        });
    });

    function getBoundingBox(img) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width; canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let minX = canvas.width, minY = canvas.height, maxX = 0, maxY = 0;
        for (let y = 0; y < canvas.height; y++) {
            for (let x = 0; x < canvas.width; x++) {
                const i = (y * canvas.width + x) * 4;
                if (data[i] < 252 || data[i+1] < 252 || data[i+2] < 252) {
                    if (x < minX) minX = x; if (x > maxX) maxX = x;
                    if (y < minY) minY = y; if (y > maxY) maxY = y;
                }
            }
        }
        if (maxX <= minX) return { x: 0, y: 0, w: img.width, h: img.height };
        const p = 5;
        return { x: Math.max(0, minX-p), y: Math.max(0, minY-p), w: Math.min(img.width-minX, (maxX-minX)+(p*2)), h: Math.min(img.height-minY, (maxY-minY)+(p*2)) };
    }

    function processImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 1000; canvas.height = 1000;
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = "white";
                    ctx.fillRect(0, 0, 1000, 1000);

                    const box = getBoundingBox(img);
                    const margin = 96;
                    const drawArea = 1000 - (margin * 2);
                    const ratio = Math.min(drawArea / box.w, drawArea / box.h);
                    const fw = box.w * ratio; const fh = box.h * ratio;
                    ctx.drawImage(img, box.x, box.y, box.w, box.h, (1000-fw)/2, (1000-fh)/2, fw, fh);

                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'preview-item';
                    itemDiv.appendChild(canvas);
                    
                    const cbWrapper = document.createElement('div');
                    cbWrapper.className = 'check-box-wrapper';
                    const cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.className = 'check-box';
                    cb.checked = true;
                    
                    cb.addEventListener('change', function() {
                        const total = processedItems.length;
                        const checked = processedItems.filter(i => i.checkbox.checked).length;
                        selectAll.checked = (total === checked);
                    });

                    cbWrapper.appendChild(cb);
                    const label = document.createElement('span');
                    label.innerText = " ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ";
                    cbWrapper.appendChild(label);
                    
                    itemDiv.appendChild(cbWrapper);
                    previewContainer.appendChild(itemDiv);
                    processedItems.push({ canvas: canvas, name: file.name, checkbox: cb });
                    resolve();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    let isDragging = false, startX;
    cartBtn.addEventListener('mousedown', (e) => { isDragging = true; startX = e.pageX - cartBtn.offsetLeft; cartBtn.style.transition = 'none'; });
    window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        let x = e.pageX - startX;
        const max = sliderWrapper.offsetWidth - cartBtn.offsetWidth - 5;
        if (x < 5) x = 5; if (x > max) x = max;
        cartBtn.style.left = x + 'px';
        if (x >= max) { isDragging = false; handleDownload(); resetSlider(); }
    });
    window.addEventListener('mouseup', () => { isDragging = false; resetSlider(); });

    // Touch support for iPad/Mobile
    cartBtn.addEventListener('touchstart', (e) => { isDragging = true; startX = e.touches[0].pageX - cartBtn.offsetLeft; cartBtn.style.transition = 'none'; });
    window.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        let x = e.touches[0].pageX - startX;
        const max = sliderWrapper.offsetWidth - cartBtn.offsetWidth - 5;
        if (x < 5) x = 5; if (x > max) x = max;
        cartBtn.style.left = x + 'px';
        if (x >= max) { isDragging = false; handleDownload(); resetSlider(); }
    });
    window.addEventListener('touchend', () => { isDragging = false; resetSlider(); });

    function resetSlider() { cartBtn.style.transition = 'left 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; cartBtn.style.left = '5px'; }

    async function handleDownload() {
        const selected = processedItems.filter(item => item.checkbox.checked);
        if (selected.length === 0) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏π‡∏õ"); return; }
        const format = downloadFormat.value;
        loading.style.display = 'block';
        if (format === 'individual') {
            selected.forEach((item, i) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.download = item.name;
                    link.href = item.canvas.toDataURL('image/jpeg', 0.95);
                    link.click();
                }, i * 400);
            });
        } else {
            const zip = new JSZip();
            selected.forEach(item => {
                const data = item.canvas.toDataURL('image/jpeg', 0.95).split(',')[1];
                zip.file(item.name, data, {base64: true});
            });
            const blob = await zip.generateAsync({type: "blob", compression: "DEFLATE", compressionOptions: {level: 9}});
            const ext = format === 'zip' ? 'zip' : '7z';
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `images.${ext}`;
            link.click();
        }
        loading.style.display = 'none';
    }
</script>

</body>
</html>